@model MarkomPos.Model.ViewModel.OfferIndexVm

@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<section class="um-wrap">
    <div class="container">
        <div class="card">
            <div class="card-header">
                <div class="btn-create-wrap">
                    <a class="btn btn-default create" href="javascript:void(0)">Create New</a>
                </div>
            </div>
            <div class="card-body">
                <div class="form-group col-md-3">
                    <label>Date range filter:</label>
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <span class="input-group-text">
                                <i class="far fa-calendar-alt"></i>
                            </span>
                        </div>
                        <input type="text" class="form-control float-right" id="filterDate" onchange="dateRangeChange()">
                    </div>
                </div>
                <div id="dvOffer"></div>
            </div>
        </div>
    </div>
</section>

<div id="dvOfferValidation" class="mrgDT">
</div>


<div id="dialog">
</div>

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<script src="http://ajax.aspnetcdn.com/ajax/jquery.ui/1.8.9/jquery-ui.js" type="text/javascript"></script>
@*<script src="https://cdn.datatables.net/buttons/1.7.1/js/dataTables.buttons.min.js" type="text/javascript"></script>
    <script src="https://cdn.datatables.net/buttons/1.7.1/js/buttons.colVis.min.js" type="text/javascript"></script>*@
@*<script src="~/Content/JS/rowReorder.js"></script>*@
<script>
    $(document).ready(function () {
        var priviousDate = new Date(new Date().setDate(new Date().getDate() - 30));

        $('#filterDate').daterangepicker({
            locale: {
                format: "MM/DD/YYYY"
            }
        });

        $('#filterDate').val(setFormatDate(priviousDate) + " - " + setFormatDate(new Date()));

        dateRangeChange();

        function setFormatDate(date) {
            var d = new Date(date),
                month = '' + (d.getMonth() + 1),
                day = '' + d.getDate(),
                year = d.getFullYear();

            if (month.length < 2)
                month = '0' + month;
            if (day.length < 2)
                day = '0' + day;

            //return [day, month, year].join('/');
            return [month, day, year].join('/');
        }

    });

    $(function () {
        $(".create").click(function () {
            var $buttonClicked = $(this);
            var options = {
                "backdrop": "static",
                keyboard: true
            };
            var ajaxCallURL = '/Offers/Create';
            $.ajax({
                type: "GET",
                url: ajaxCallURL,
                contentType: "application/json; charset=utf-8",
                datatype: "json",
                success: function (data) {
                    $('#dialog').html(data);
                    $('#myModal').modal(options);
                    $('#myModal').modal('show');
                },
                error: function () {
                    alert("Content load failed.");
                }
            });
        });
    });
    function OpenEditOfferPage(Id) {
        var options = {
            "backdrop": "static",
            keyboard: true
        };
        var ajaxCallURL = '/Offers/Edit?id=' + Id;
        $.ajax({
            type: "GET",
            url: ajaxCallURL,
            contentType: "application/json; charset=utf-8",
            datatype: "json",
            success: function (data) {
                $('#dialog').html(data);
                $('#myModal').modal(options);
                $('#myModal').modal('show');
            },
            error: function () {
                alert("Content load failed.");
            }
        });
    }
    function OpenDetailsOfferPage(Id) {
        var $buttonClicked = $(this);
        var options = {
            "backdrop": "static",
            keyboard: true
        };
        var ajaxCallURL = '/Offers/Details?id=' + Id;
        $.ajax({
            type: "GET",
            url: ajaxCallURL,
            contentType: "application/json; charset=utf-8",
            datatype: "json",
            success: function (data) {
                $('#dialog').html(data);
                $('#detailsModal').modal(options);
                $('#detailsModal').modal('show');
            },
            error: function () {
                alert("Content load failed.");
            }
        });
    }

    function dateRangeChange() {
        $.ajax({
            url: '/Offers/OfferFilter?dateRange=' + $('#filterDate').val(),
            datatype: "json",
            type: "post",
            contenttype: 'application/json; charset=utf-8',
            async: true,
            success: function (data) {
                $("#dvOffer").html(data);
            },
            error: function (xhr) {
                alert('error');
            }
        });
    }
</script>
